{
    "variables": {
        "aws_access_key": "",
        "aws_secret_key": "",
        "aws_region": "",
        "ami_source": "",
        "aws_instance_type": "",
        "do_token": "",
        "digitalocean_image_os": "",
        "digitalocean_region": "",
        "digitalocean_image_size": "",
        "digitalocean_image_name": "",
        "consul_version": "",
        "docker_version": "",
        "docker_compose_version": "",
        "gitlab_version": "",
        "redis_version": "",
        "aws_key_name": "",
        "packer_dir": "{{env `CUR_DIR`}}"
    },
    "builders": [
        {
          "type": "digitalocean",
          "api_token": "{{user `do_token`}}",
          "image": "{{user `digitalocean_image_os`}}",
          "region": "{{user `digitalocean_region`}}",
          "size": "{{user `digitalocean_image_size`}}",
          "ssh_username": "root",
          "snapshot_name": "{{user `digitalocean_image_name`}}"
        }
    ],
    "provisioners": [
        {
            "type": "shell",
            "inline": [ "mkdir -p /tmp/scripts", "mkdir -p /home/ubuntu/.ssh" ]
        },
        {
            "type": "file",
            "source": "{{user `packer_dir`}}/scripts/",
            "destination": "/tmp/scripts"
        },
        {
            "type": "file",
            "source": "{{user `packer_dir`}}/ignore/authorized_keys",
            "destination": "/home/ubuntu/.ssh/authorized_keys"
        },
        {
            "type": "file",
            "source": "{{user `packer_dir`}}/ignore/authorized_keys",
            "destination": "/root/.ssh/authorized_keys"
        },
        {
            "type": "shell",
            "inline": [
                "chmod +x /tmp/scripts/init.sh",
                "chmod +x /tmp/scripts/install/install_docker.sh",
                "chmod +x /tmp/scripts/install/install_redis.sh",
                "chmod +x /tmp/scripts/move.sh",
                "sudo bash /tmp/scripts/init.sh -c {{user `consul_version`}} -d {{user `docker_compose_version`}} -g {{user `gitlab_version`}}",
                "sudo bash /tmp/scripts/install/install_docker.sh -v {{user `docker_version`}}",
                "sudo bash /tmp/scripts/install/install_redis.sh -v {{user `redis_version`}}",
                "sudo bash /tmp/scripts/move.sh"
            ]
        }
    ]
}
